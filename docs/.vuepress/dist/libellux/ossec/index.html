<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OSSEC Host Intrusion Detection System | Libellux</title>
    <meta name="description" content="Libellux: Library &amp; Education">
    <meta name="generator" content="VuePress 1.3.0">
    <link rel="icon" href="/img/avatar.png">
    <meta name="robots" content="noindex, nofollow">
    <link rel="preload" href="/assets/css/0.styles.be31f34f.css" as="style"><link rel="preload" href="/assets/js/app.c5ff77c0.js" as="script"><link rel="preload" href="/assets/js/2.e57010f3.js" as="script"><link rel="preload" href="/assets/js/12.5c35bfe3.js" as="script"><link rel="prefetch" href="/assets/js/10.fad2df1d.js"><link rel="prefetch" href="/assets/js/11.253467d5.js"><link rel="prefetch" href="/assets/js/13.1bf7d69e.js"><link rel="prefetch" href="/assets/js/14.ef3180e3.js"><link rel="prefetch" href="/assets/js/15.56c86635.js"><link rel="prefetch" href="/assets/js/16.018ca0bf.js"><link rel="prefetch" href="/assets/js/17.98e3f641.js"><link rel="prefetch" href="/assets/js/18.b5a0efbd.js"><link rel="prefetch" href="/assets/js/19.17d38663.js"><link rel="prefetch" href="/assets/js/20.3d3b3f4f.js"><link rel="prefetch" href="/assets/js/21.3998da5a.js"><link rel="prefetch" href="/assets/js/22.6914d8b5.js"><link rel="prefetch" href="/assets/js/23.48744478.js"><link rel="prefetch" href="/assets/js/24.37815ab2.js"><link rel="prefetch" href="/assets/js/3.8041e236.js"><link rel="prefetch" href="/assets/js/4.79ae2127.js"><link rel="prefetch" href="/assets/js/5.0ef1bf6b.js"><link rel="prefetch" href="/assets/js/6.6c9a97be.js"><link rel="prefetch" href="/assets/js/7.cdd3fba3.js"><link rel="prefetch" href="/assets/js/8.459f8454.js"><link rel="prefetch" href="/assets/js/9.91c039f0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.be31f34f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/avatar.png" alt="Libellux" class="logo"> <span class="site-name can-hide">Libellux</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/libellux/" class="nav-link router-link-active">
  Libellux: Up and Running
</a></div><div class="nav-item"><a href="/win98/" class="nav-link">
  Win 98 PC build
</a></div> <a href="https://github.com/libellux/libellux-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/libellux/" class="nav-link router-link-active">
  Libellux: Up and Running
</a></div><div class="nav-item"><a href="/win98/" class="nav-link">
  Win 98 PC build
</a></div> <a href="https://github.com/libellux/libellux-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Library &amp; Education</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/" class="sidebar-link">Introduction</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Libellux: Up and Running</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/libellux/" class="sidebar-link">Introduction</a></li><li><a href="/libellux/mmonit/" class="sidebar-link">M/Monit System Monitoring</a></li><li><a href="/libellux/pcp/" class="sidebar-link">Performance Co-Pilot Grafana</a></li><li><a href="/libellux/ossec/" class="active sidebar-link">OSSEC Host Intrusion Detection</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/libellux/ossec/#configuration-files" class="sidebar-link">Configuration files</a></li><li class="sidebar-sub-header"><a href="/libellux/ossec/#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/libellux/ossec/#installation" class="sidebar-link">Installation</a></li><li class="sidebar-sub-header"><a href="/libellux/ossec/#configuration" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/libellux/ossec/#firewall-settings" class="sidebar-link">Firewall settings</a></li><li class="sidebar-sub-header"><a href="/libellux/ossec/#m-monit-monitoring" class="sidebar-link">M/Monit monitoring</a></li><li class="sidebar-sub-header"><a href="/libellux/ossec/#slack-notifications" class="sidebar-link">Slack notifications</a></li><li class="sidebar-sub-header"><a href="/libellux/ossec/#integrating-cloudflare" class="sidebar-link">Integrating Cloudflare</a></li><li class="sidebar-sub-header"><a href="/libellux/ossec/#upgrading" class="sidebar-link">Upgrading</a></li><li class="sidebar-sub-header"><a href="/libellux/ossec/#command-line" class="sidebar-link">Command-line</a></li><li class="sidebar-sub-header"><a href="/libellux/ossec/#troubleshooting" class="sidebar-link">Troubleshooting</a></li></ul></li><li><a href="/libellux/psad/" class="sidebar-link">PSAD Intrusion Detection</a></li><li><a href="/libellux/openvas/" class="sidebar-link">OpenVAS Vulnerability Scanner</a></li><li><a href="/libellux/graylog/" class="sidebar-link">Graylog Centralized Log Management</a></li><li><a href="/libellux/rsyslog/" class="sidebar-link">Rsyslog Log Processing</a></li><li><a href="/libellux/jira/" class="sidebar-link">Jira Service Desk</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Windows 98 PC build</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/win98/" class="sidebar-link">Overview</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ossec-host-intrusion-detection-system"><a href="#ossec-host-intrusion-detection-system" class="header-anchor">#</a> OSSEC Host Intrusion Detection System</h1> <p>Setup and configuration has been tested on following OS with version:</p> <ul><li>Ubuntu 16.04, Ubuntu 18.04</li> <li>2.9.0 -&gt; 3.4.0</li></ul> <h2 id="configuration-files"><a href="#configuration-files" class="header-anchor">#</a> Configuration files</h2> <ul><li><a href="https://github.com/featzor/docs/blob/master/conf/ossec/ossec.conf" target="_blank" rel="noopener noreferrer">ossec.conf<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (server)</li> <li>ossec.conf (agent)</li></ul> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <ul><li><code>libssl-dev</code></li> <li><code>zlib1g-dev</code></li> <li><code>inotify-tools</code></li> <li><code>build-essential</code></li> <li><code>pcre2</code> library for version &gt;= 3.3.0 (<a href="https://ftp.pcre.org/pub/pcre/" target="_blank" rel="noopener noreferrer">ftp.pcre.org<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</li></ul> <h2 id="installation"><a href="#installation" class="header-anchor">#</a> Installation</h2> <h3 id="install-ossec-server"><a href="#install-ossec-server" class="header-anchor">#</a> Install OSSEC server</h3> <p><img src="/img/ubuntu.png" alt="Ubuntu"> <img src="/img/centos.png" alt="CentOS"></p> <p>Download the <a href="https://github.com/ossec/ossec-hids/releases" target="_blank" rel="noopener noreferrer">latest stable version<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> from ossec-hids github. Untar the the file and run the install script.</p> <div class="language-console extra-class"><pre class="language-text"><code>foo@bar:~$ wget https://github.com/ossec/ossec-hids/archive/3.4.0.tar.gz
foo@bar:~$ tar -zxvf 3.4.0.tar.gz
foo@bar:~$ cd ossec-hids-3.4.0/
foo@bar:~$ sudo PCRE2_SYSTEM=yes ./install.sh
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">NOTE</p> <p>If missing the dependencies download the required package(s) and proceed with installation.</p></div> <div class="language-console extra-class"><pre class="language-text"><code>foo@bar:~$ wget https://ftp.pcre.org/pub/pcre/pcre2-10.32.tar.gz
foo@bar:~$ tar -zxvf pcre2-10.32.tar.gz -C src/external/
foo@bar:~$ sudo apt-get install libssl-dev lib1g-dev inotifiy-tools build-essential
foo@bar:~$ sudo PCRE2_SYSTEM=yes ./install.sh
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>[sudo] password for user: (en/br/cn/de/el/es/fr/hu/it/jp/nl/pl/ru/sr/tr) [en]: ENTER
What kind of installation do you want (server, agent, local, hybrid or help)? server
Choose where to install the OSSEC HIDS [/var/ossec/]: ENTER
Do you want e-mail notification? (y/n) [y]: n
Do you want to run the integrity check daemon? (y/n) [y]: y
Do you want to run the rootkit detection engine? (y/n) [y]: y
Do you want to enable active response? (y/n) [y]: y
Do you want to enable the firewall-drop response? (y/n) [y]: y
Do you want to add more IPs to the white list? (y/n)? [n]: n
Do you want to enable remote syslog (port 514 udp)? (y/n) [y]: n
--- Press ENTER to finish (maybe more information below). ---
</code></pre></div><h2 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h2> <p>Before activating the OSSEC client we need to make some adjustments to our OSSEC server. We will start by editing the configuration file (server-side) and whitelist the OSSEC clients IP address as well as secure applications communicating with our client(s).</p> <div class="language-console extra-class"><pre class="language-text"><code>foo@bar:~$ sudo nano /var/ossec/etc/ossec.conf
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>&lt;global&gt;
    &lt;white_list&gt;[OSSEC-CLIENT-IP]&lt;/white_list&gt;
&lt;/global&gt;
</code></pre></div><p>Furthermore, to enable the function to harvest syslog we need to establish that our remote client connection is secure and allow it.</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;remote&gt;
    &lt;connection&gt;secure&lt;/connection&gt;
    &lt;allowed-ips&gt;[OSSEC-CLIENT-IP]&lt;/allowed-ips&gt;
&lt;/remote&gt;
</code></pre></div><p>Next we need to add the client to our OSSEC server and generate a client key. Run the command shown in the code segment below and follow the setup to fit our setup.</p> <div class="language-console extra-class"><pre class="language-text"><code>foo@bar:~$ sudo /var/ossec/bin/manage_agents
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>****************************************
* OSSEC HIDS v3.4.0 Agent Manager.     *
* The following options are available: *
****************************************
    (A)dd an agent (A).  
    (E)xtract key for an agent (E).
    (L)ist already added agents (L).
    (R)emove an agent (R).
    (Q)quit.
Choose your action: A,E,L,R or Q: a
- Adding a new agent (use â€˜\qâ€™ to return to the main menu).
    Please provide the following:
    * A name for the new agent: [CLIENT-SERVER-NAME]
    * The IP Address of the new agent: [OSSEC-CLIENT-IP]
    * An ID for the new agent[000]: 001
Agent information:
    ID:001
    Name:[CLIENT-SERVER-NAME]
    IP Address:[OSSEC-CLIENT-IP]
Confirm adding it?(y/n): y
</code></pre></div><p>Once we added the client proceed by extracting its agent key by providing the assigned agent ID.</p> <div class="language- extra-class"><pre class="language-text"><code>Choose your action: A,E,L,R or Q: e
Provide the ID of the agent to extract the key (or '\q' to quit): 001
Agent key information for '001' is:
-AGENT KEY-
** Press Enter to return to the main menu.
</code></pre></div><p>Next we need to go back to our OSSEC client and import our extracted agent key. Execute the command, shown in the code section below, on the agent machine and paste the key. Validate that our agent information is correct before adding it.</p> <div class="language-console extra-class"><pre class="language-text"><code>foo@bar:~$ sudo /var/ossec/bin/manage_agents
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>****************************************
* OSSEC HIDS v2.9.0 Agent Manager.     *
* The following options are available: *
****************************************
    (I)mport key from the server (I).
    (Q)uit.
Choose your action: I or Q: i
â€¦
Paste it here (or '\q' to quit): -PASTE AGENT KEY-
Agent information:
    ID:001
    Name:[CLIENT-SERVER-NAME]
    IP Address:[OSSEC-CLIENT-IP]
Confirm adding it?(y/n): y
** Press ENTER to return to the main menu.
** You must restart OSSEC for your changes to take effect.
</code></pre></div><p>When we confirmed the agent, and have an assigned ID, go back once again to our OSSEC server and add the new agent ID within the active-response section, regarding Slack notifications, in the server's configuration file.</p> <div class="language-console extra-class"><pre class="language-text"><code>foo@bar:~$ sudo nano /var/ossec/etc/ossec.conf
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>&lt;active-response&gt;
    &lt;command&gt;ossec-slack&lt;/command&gt;
    &lt;location&gt;server,001&lt;/location&gt;
    &lt;level&gt;7&lt;/level&gt;
&lt;/active-response&gt;
</code></pre></div><p>At client edit the OSSEC configuration file and ensure that the server IP is correct, and the repeated offenders section as well as the email directive is set.</p> <div class="language-console extra-class"><pre class="language-text"><code>foo@bar:~$ sudo nano /var/ossec/etc/ossec.conf
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>&lt;ossec_config&gt;
    &lt;client&gt;
        &lt;server-ip&gt;[OSSEC-HOST-IP]&lt;/server-ip&gt;
    &lt;/client&gt;
    &lt;active-response&gt;
        &lt;repeated_offenders&gt;30,60,120,240,480&lt;/repeated_offenders&gt;
    &lt;/active-response&gt;
    &lt;global&gt;
        &lt;email_notification&gt;no&lt;/email_notification&gt;
    &lt;/global&gt;
</code></pre></div><p>Finally reload the OSSEC server and restart the client to enable and activate OSSEC HIDS.</p> <div class="language-console extra-class"><pre class="language-text"><code>foo@bar:~$ sudo /var/ossec/bin/ossec-control reload
foo@bar:~$ sudo /var/ossec/bin/ossec-control restart
</code></pre></div><p>Now after a short while m/monit should alert us that OSSEC processes are indeed running on our newly added client. To confirm that OSSEC and Slack alerts works, we can trigger rule 10100: First time user logged in, by simply login to our system through SSH. Once we are satisfied and rest assured everything works accurately and that syntax for configuration files and local rules (OSSEC server) are in order, proceed by enabling active response for the agent.</p> <p>To enable the active response (intrusion prevention) plugin add the following sections found in the code segment beneath. Be assured that all services and applications running against our client is either whitelisted or configured in a way so we do not by mistake automatically ban necessary services. To apply our changes, once weâ€™re satisfied, reload OSSEC.</p> <div class="language-console extra-class"><pre class="language-text"><code>foo@bar:~$ sudo nano /var/ossec/etc/ossec.conf
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>&lt;command&gt;
    &lt;name&gt;firewall-drop&lt;/name&gt;
    &lt;executable&gt;firewall-drop.sh&lt;/executable&gt;
    &lt;expect&gt;srcip&lt;/expect&gt;
    &lt;timeout_allowed&gt;yes&lt;/timeout_allowed&gt;
&lt;/command&gt;

&lt;active-response&gt;
    &lt;disabled&gt;no&lt;/disabled&gt;
    &lt;command&gt;firewall-drop&lt;/command&gt;
    &lt;agent_id&gt;[UID]&lt;/agent_id&gt;
    &lt;location&gt;local&lt;/location&gt;
    &lt;rules_id&gt;[optional]&lt;/rules_id&gt;
    &lt;level&gt;6&lt;/level&gt;
    &lt;timeout&gt;600&lt;/timeout&gt;
&lt;/active-response&gt;
</code></pre></div><div class="language-console extra-class"><pre class="language-text"><code>foo@bar:~$ sudo /var/ossec/bin/ossec-control reload
</code></pre></div><h2 id="firewall-settings"><a href="#firewall-settings" class="header-anchor">#</a> Firewall settings</h2> <div class="language-console extra-class"><pre class="language-text"><code>foo@bar:~$ sudo ufw allow proto udp from [AGENT/SERVER] to any port 1514 comment &quot;OSSEC&quot;
</code></pre></div><h2 id="m-monit-monitoring"><a href="#m-monit-monitoring" class="header-anchor">#</a> M/Monit monitoring</h2> <p>To monitor if the OSSEC daemons are running accordingly, we use Monit to monitor their status. Edit the Monit configuration file and add the lines below, continue with reloading the Monit daemon to apply our new monitor rules. If working correctly we shall now receive m/monit alerts saying processes is not running.</p> <div class="language-console extra-class"><pre class="language-text"><code>foo@bar:~$ sudo nano /usr/local/etc/monitrc
</code></pre></div><div class="language-config extra-class"><pre class="language-text"><code># OSSEC processes
check process ossec-agentd matching &quot;ossec-agentd&quot;
check process ossec-execd matching &quot;ossec-execd&quot;
check process ossec-logcollector matching &quot;ossec-logcollector&quot;
check process ossec-syscheckd matching &quot;ossec-syscheckd&quot;
</code></pre></div><div class="language-console extra-class"><pre class="language-text"><code>foo@bar:~$ cd /usr/local/
foo@bar:~$ sudo ./bin/monit reload
</code></pre></div><h3 id="monitor-m-monit-failed-login-attempts-with-ossec"><a href="#monitor-m-monit-failed-login-attempts-with-ossec" class="header-anchor">#</a> Monitor M/Monit failed login attempts with OSSEC</h3> <p>Add the local file path in ossec.conf (client side).</p> <div class="language-console extra-class"><pre class="language-text"><code>foo@bar:~$ sudo nano /var/ossec/etc/ossec.conf
</code></pre></div><div class="language-config extra-class"><pre class="language-text"><code>&lt;localfile&gt;
    &lt;log_format&gt;syslog&lt;/log_format&gt;
    &lt;location&gt;/usr/local/mmonit-3.7.2/logs/error.log&lt;/location&gt;
&lt;/localfile&gt;
</code></pre></div><p>Create a custom rule on the server and increase alert level to receive slack alerts.</p> <div class="language-console extra-class"><pre class="language-text"><code>foo@bar:~$ sudo nano /var/ossec/rules/local_rules.xml
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>102000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>7<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if_sid</span><span class="token punctuation">&gt;</span></span>2501<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if_sid</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>match</span><span class="token punctuation">&gt;</span></span>Unauthorized, authentication failed for<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>match</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>group</span><span class="token punctuation">&gt;</span></span>authentication_failed,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>group</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>User authentication failure.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="slack-notifications"><a href="#slack-notifications" class="header-anchor">#</a> Slack notifications</h2> <div class="language-console extra-class"><pre class="language-text"><code>foo@bar:~$ sudo nano /var/ossec/active-response/bin/ossec-slack.sh
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">NOTE</p> <p>Make sure that the log path only has one backtrail /../</p></div> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">CHANNEL</span><span class="token operator">=</span><span class="token string">&quot;#example&quot;</span>
<span class="token assign-left variable">SITE</span><span class="token operator">=</span><span class="token string">&quot;webhook url&quot;</span>
<span class="token assign-left variable">SOURCE</span><span class="token operator">=</span><span class="token string">&quot;ossec2slack&quot;</span>
<span class="token punctuation">..</span>.
<span class="token comment"># Logging</span>
<span class="token builtin class-name">cd</span> <span class="token variable">$LOCAL</span>
<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/
<span class="token assign-left variable"><span class="token environment constant">PWD</span></span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">`</span><span class="token function">date</span><span class="token variable">`</span></span> <span class="token variable">$0</span> <span class="token variable">$1</span> <span class="token variable">$2</span> <span class="token variable">$3</span> <span class="token variable">$4</span> <span class="token variable">$5</span> <span class="token variable">$6</span> <span class="token variable">$7</span> <span class="token variable">$8</span>&quot;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${<span class="token environment constant">PWD</span>}</span>/<span class="token punctuation">..</span>/logs/active-responses.log
</code></pre></div><h2 id="integrating-cloudflare"><a href="#integrating-cloudflare" class="header-anchor">#</a> Integrating Cloudflare</h2> <h2 id="upgrading"><a href="#upgrading" class="header-anchor">#</a> Upgrading</h2> <p>To upgrade to OSSEC 3.3.0 using the PCRE2 package simply download the package and install and upgrade OSSEC as normal:</p> <div class="language- extra-class"><pre><code>$ wget https://ftp.pcre.org/pub/pcre/pcre2-10.32.tar.gz
$ tar -zxvf pcre2-10.32.tar.gz -C src/external/
$ sudo ./install
</code></pre></div><p>To upgrade OSSEC simply download the <a href="https://github.com/ossec/ossec-hids/releases" target="_blank" rel="noopener noreferrer">latest release<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, extract the file and run the install script.</p> <div class="language- extra-class"><pre><code>OSSEC HIDS v2.9.3 Installation Script - http://www.ossec.net

You are about to start the installation process of the OSSEC HIDS.
You must have a C compiler pre-installed in your system.

    - System: Linux hostname 4.4.0-116-generic
    - User: root
    - Host: hostname

-- Press ENTER to continue or Ctrl-C to abort. --

- You already have OSSEC installed. Do you want to update it? (y/n): y
</code></pre></div><h2 id="command-line"><a href="#command-line" class="header-anchor">#</a> Command-line</h2> <table><thead><tr><th>Command</th> <th>Description</th></tr></thead> <tbody><tr><td>/var/ossec/bin/agent_control -lc</td> <td>List all active agents</td></tr> <tr><td>/var/ossec/bin/ossec-logtest</td> <td>Logtest</td></tr> <tr><td>/var/ossec/bin/ossec-control</td> <td>start,stop,reload,restart,status,enable,disable</td></tr> <tr><td>/var/ossec/bin/manage_agents</td> <td>manage agents (e.g., add, remove)</td></tr></tbody></table> <h2 id="troubleshooting"><a href="#troubleshooting" class="header-anchor">#</a> Troubleshooting</h2> <p>If you encounter any issue or having questions regarding OSSEC I recommend using their very helpful <a href="https://groups.google.com/forum/#!forum/ossec-list" target="_blank" rel="noopener noreferrer">mailing list<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="duplicate-counter-error"><a href="#duplicate-counter-error" class="header-anchor">#</a> Duplicate counter error</h3> <p>In the OSSEC log /var/ossec/logs/ossec.log, you might notice that the log gets filled with warnings and errors as shown below.</p> <div class="language-log extra-class"><pre class="language-text"><code>2019/02/21 13:33:21 ossec-remoted: WARN: Duplicate error: [...]
2019/02/21 13:33:21 ossec-remoted(1407): ERROR: Duplicated counter for [...]
</code></pre></div><p>Stop both the OSSEC manager and the agent. In the agent server go to /var/ossec/queue/rids and remove all the files within the folder. At the manager server go into /var/ossec/queue/rids remove the file corresponding to the agents ID. Do not delete the sender_counter. Restart both.</p> <p>Or disable the feature by editing /var/ossec/etc/internal_options.conf</p> <div class="language- extra-class"><pre><code># Verify msg id (set to 0 to disable it)
remoted.verify_msg_id=0
</code></pre></div><p>Save and restart.</p> <h3 id="reference"><a href="#reference" class="header-anchor">#</a> Reference</h3> <ul><li><a href="https://ossec-docs.readthedocs.io/en/latest/faq/unexpected.html#fixing-duplicate-errors" target="_blank" rel="noopener noreferrer">ossec-docs.readthedocs.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/libellux/libellux-docs/edit/master/libellux/ossec/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/7/2020, 5:25:05 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/libellux/pcp/" class="prev">
        Performance Co-Pilot Grafana
      </a></span> <span class="next"><a href="/libellux/psad/">
        PSAD Intrusion Detection
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.c5ff77c0.js" defer></script><script src="/assets/js/2.e57010f3.js" defer></script><script src="/assets/js/12.5c35bfe3.js" defer></script>
  </body>
</html>
